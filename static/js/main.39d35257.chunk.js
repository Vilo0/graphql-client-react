(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{129:function(e,t,a){"use strict";a.r(t);var n=a(1),s=a(26),c=a.n(s),r=a(10),o=a.n(r),i=a(17),l=a(6),u=a(9),j=a(37),d=a(40);d.initializeApp({apiKey:"AIzaSyCseEVSET6RjDfdaGzogOAqJuN0yV09hHo",authDomain:"graphql-escalab-2021.firebaseapp.com",projectId:"graphql-escalab-2021",storageBucket:"graphql-escalab-2021.appspot.com",messagingSenderId:"847651493416",appId:"1:847651493416:web:d8a4641d20525d2acd871d"});var b,p,m,O,h,x,g,f,v,N,y,w,S,C,P=d.auth(),k=new d.auth.GoogleAuthProvider,I=a(0),E=function(e,t){switch(t.type){case"LOGGED_IN_USER":return Object(u.a)(Object(u.a)({},e),{},{user:t.payload});default:return e}},_={user:null},D=Object(n.createContext)(),U=function(e){var t=e.children,a=Object(n.useReducer)(E,_),s=Object(l.a)(a,2),c=s[0],r=s[1],u=Object(j.f)();Object(n.useEffect)((function(){u.listen((function(e){console.log("You changed the page to: ".concat(e.pathname))}))}),[u]),Object(n.useEffect)((function(){var e=P.onAuthStateChanged(function(){var e=Object(i.a)(o.a.mark((function e(t){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return e.next=3,t.getIdTokenResult();case 3:a=e.sent,r({type:"LOGGED_IN_USER",payload:{email:t.email,token:a.token}}),e.next=8;break;case 7:r({type:"LOGGED_IN_USER",payload:null});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return function(){return e()}}),[]);var d={state:c,dispatch:r};return Object(I.jsx)(D.Provider,{value:d,children:t})},L=a(12),q=(a(99),a(42)),R=a(24),$=a(15),A=function(){var e=Object(n.useContext)(D),t=e.state,a=e.dispatch,s=Object(n.useState)(""),c=Object(l.a)(s,2),r=c[0],o=c[1],i=Object(j.f)(),u=t.user;return Object(I.jsxs)("nav",{className:"navbar navbar-expand-lg navbar-light bg-light ",children:[Object(I.jsx)(L.b,{className:"navbar-brand",to:"/",children:"Navbar"}),Object(I.jsx)("button",{className:"navbar-toggler",type:"button","data-toogle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(I.jsx)("span",{className:"navbar-toggler-icon"})}),Object(I.jsxs)("div",{className:"collapse navbar-collapse",id:"navbarSupportedContent",children:[Object(I.jsxs)("ul",{className:"navbar-nav mr-auto",children:[Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)(L.c,{className:"nav-link",to:"/users",activeClassName:"active",children:"Users"})}),Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)(L.c,{className:"nav-link",to:"/posts",activeClassName:"active",children:"Posts"})}),u&&Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)(L.c,{className:"nav-link",to:"/profile",activeClassName:"active",children:u&&u.email.split("@")[0]})}),!u&&Object(I.jsxs)(n.Fragment,{children:[Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)(L.b,{className:"nav-link",to:"/login",children:"Login"})}),Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)(L.b,{className:"nav-link",to:"/register",children:"Register"})})]}),u&&Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)("a",{onClick:function(){Object(d.auth)().signOut(),a({type:"LOGGED_IN_USER",payload:null})},href:"/login",className:"nav-item nav-link",children:"Logout"})})]}),Object(I.jsxs)("form",{onSubmit:function(e){e.preventDefault(),i.push({pathname:"/posts",state:{search:r}})},className:"form-inline my-2 my-lg-0",children:[Object(I.jsx)("input",{className:"form-control mr-sm-2",type:"search",placeholder:"Search","aria-label":"Search",onChange:function(e){return o(e.target.value)},name:"search"}),Object(I.jsx)("button",{className:"btn btn-outline-success my-2 my-sm-0",type:"submit",children:"Search"})]})]})]})},B=a(14),G=a(21),F=a(58),T=a.n(F),M=T()(b||(b=Object(G.a)(["\n  fragment userInfo on User {\n    _id\n    name\n    username\n    email\n    images {\n      url\n      public_id\n    }\n    about\n    createdAt\n    updatedAt\n  }\n"]))),Q=T()(p||(p=Object(G.a)(["\n  fragment postData on Post {\n    _id\n    content\n    image {\n      url\n      public_id\n    }\n    postedBy {\n      _id\n      username\n      email\n    }\n  }\n"]))),H=T()(m||(m=Object(G.a)(["\n  query {\n    profile {\n      ...userInfo\n    }\n  }\n  ","\n"])),M),V=T()(O||(O=Object(G.a)(["\n  query publicProfile($username: String!) {\n    publicProfile(username: $username) {\n      _id\n      username\n      name\n      email\n      images {\n        url\n        public_id\n      }\n      about\n    }\n  }\n"]))),z=T()(h||(h=Object(G.a)(["\n  query {\n    allUsers {\n      ...userInfo\n    }\n  }\n  ","\n"])),M),J=T()(x||(x=Object(G.a)(["\n  query {\n    totalPosts\n  }\n"]))),W=T()(g||(g=Object(G.a)(["\n  query allPosts($limit: Int, $page: Int, $search: String){\n    allPosts(limit: $limit, page: $page, search: $search) {\n      posts {\n        ...postData\n      },\n      page,\n      pages,\n      total\n    }\n  }\n  ","\n"])),Q),Y=T()(f||(f=Object(G.a)(["\n  query postsByUser($limit: Int, $page: Int, $search: String) {\n    postsByUser (limit: $limit, page: $page, search: $search) {\n      posts {\n        ...postData\n      }\n      page,\n      pages,\n      total\n    }\n  }\n  ","\n"])),Q),K=T()(v||(v=Object(G.a)(["\n  query postShow($id: ID!) {\n    postShow (id: $id) {\n      ...postData\n    }\n  }\n  ","\n"])),Q),X=function(e){var t=e.image,a=e.handleImageRemove,n=void 0===a?function(e){return e}:a;return Object(I.jsx)("img",{src:t.url,alt:t.public_id,style:{height:"100px"},className:"img-thumbnail my-3",onClick:function(){return n(t.public_id)}},t.public_id)},Z=function(e){var t=e.post,a=e.onShow,n=e.onShowDelete,s=e.onShowUpdate,c=e.postModal,r=e.email,o=t.image,i=t.content;return Object(I.jsxs)("div",{className:"card text-center",style:{minHeight:"375px "},children:[Object(I.jsxs)("div",{className:"card-body",children:[Object(I.jsx)(X,{image:o}),Object(I.jsx)(L.b,{to:"/user/".concat(t.postedBy.username),children:Object(I.jsxs)("h4",{className:"text-primary",children:["@",t.postedBy.username]})}),Object(I.jsx)("hr",{}),Object(I.jsx)("small",{children:i})]}),Object(I.jsx)("div",{className:"card-footer",children:Object(I.jsxs)("div",{className:"row",children:[Object(I.jsx)("div",{className:"col-4 text-center m-0 p-0",children:Object(I.jsx)("button",{onClick:function(){return function(e){a(),c(e)}(t)},className:"btn btn-primary",type:"button",children:"Detalle"})}),r===t.postedBy.email&&Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)("div",{className:"col-4 text-center m-0 p-0",children:Object(I.jsx)("button",{onClick:function(){return function(e){s(),c(e)}(t)},className:"btn btn-warning",type:"button",children:"Editar"})}),Object(I.jsx)("div",{className:"col-4 text-center m-0 p-0",children:Object(I.jsx)("button",{onClick:function(){return function(e){n(),c(e)}(t)},className:"btn btn-danger",type:"button",children:"Borrar"})})]})]})})]})},ee=function(e){var t=e.user,a=t.username,n=t.images,s=t.about;return Object(I.jsx)("div",{className:"card text-center",style:{minHeight:"375px "},children:Object(I.jsxs)("div",{className:"card-body",children:[Object(I.jsx)(X,{image:n[0]}),Object(I.jsx)(L.b,{to:"/user/".concat(a),children:Object(I.jsxs)("h4",{className:"text-primary",children:["@",a]})}),Object(I.jsx)("hr",{}),Object(I.jsx)("small",{children:s})]})})},te=function(){var e=Object(B.c)(z),t=e.data;return e.loading?Object(I.jsx)("p",{className:"p-5",children:"Loading..."}):Object(I.jsx)("div",{className:"container",children:Object(I.jsx)("div",{className:"row p-5",children:t&&t.allUsers.map((function(e){return Object(I.jsx)("div",{className:"col-md-4 p-2",children:Object(I.jsx)(ee,{user:e})},e._id)}))})})},ae=function(e){var t=e.email,a=void 0===t?"":t,n=e.password,s=void 0===n?"":n,c=e.loading,r=e.setEmail,o=void 0===r?function(e){return e}:r,i=e.setPassword,l=e.handleSubmit,u=e.showPasswordInput,j=void 0!==u&&u,d=e.hideEmailInput,b=void 0!==d&&d;return Object(I.jsxs)("form",{onSubmit:l,children:[!b&&Object(I.jsxs)("div",{className:"form-group",children:[Object(I.jsx)("label",{children:"Email Address"}),Object(I.jsx)("input",{type:"email",value:a,onChange:function(e){return o(e.target.value)},className:"form-control",placeholder:"Enter email",disabled:c})]}),j&&Object(I.jsxs)("div",{className:"form-group",children:[Object(I.jsx)("label",{children:"Password"}),Object(I.jsx)("input",{type:"password",value:s,onChange:function(e){return i(e.target.value)},className:"form-control",placeholder:"Enter password",disabled:c,required:!0})]}),Object(I.jsx)("button",{className:"btn btn-raised btn-primary",disabled:c,children:"Submit"})]})},ne=function(){var e=Object(n.useState)("demo@mail.cl"),t=Object(l.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)(!1),r=Object(l.a)(c,2),u=r[0],j=r[1],d=function(){var e=Object(i.a)(o.a.mark((function e(t){var n,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),j(!0),n={url:"http://localhost:3000/complete-registration",handleCodeInApp:!0},e.next=5,P.sendSignInLinkToEmail(a,n);case 5:c=e.sent,console.log("result",c),$.b.success("Email is sent to ".concat(a,", click the link to complete your registration.")),window.localStorage.setItem("emailForRegistration",a),s(""),j("");case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(I.jsxs)("div",{className:"container p-5",children:[u?Object(I.jsx)("h4",{className:"text-danger",children:"Loading..."}):Object(I.jsx)("h4",{children:"Register"}),Object(I.jsx)(ae,{email:a,loading:u,setEmail:s,handleSubmit:d})]})},se=function(){var e=Object(n.useState)(""),t=Object(l.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)(!1),r=Object(l.a)(c,2),u=r[0],j=r[1],d=function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),j(!0),P.currentUser.updatePassword(a).then((function(){j(!1),$.b.success("Password updated")})).catch((function(e){j(!1),$.b.error(e.message)}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(I.jsxs)("div",{className:"container p-5",children:[u?Object(I.jsx)("h4",{className:"text-danger",children:"Loading..."}):Object(I.jsx)("h4",{children:"Password update"}),Object(I.jsx)(ae,{password:a,setPassword:s,loading:u,handleSubmit:d,showPasswordInput:"true",hideEmailInput:"true"})]})},ce=function(){var e=Object(n.useState)(""),t=Object(l.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)(!1),r=Object(l.a)(c,2),u=r[0],j=r[1],d=function(){var e=Object(i.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),j(!0),n={url:"http://localhost:3000/login",handleCodeInApp:!0},e.next=5,P.sendPasswordResetEmail(a,n).then((function(){s(""),j(!1),$.b.success("Email is sent to ".concat(a,". Click on the link to reset your password"))})).catch((function(e){j(!1),console.log("error on password forgot email",e)}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(I.jsxs)("div",{className:"container p-5",children:[u?Object(I.jsx)("h4",{children:"Loading..."}):Object(I.jsx)("h4",{children:"Forgot Password "}),Object(I.jsx)(ae,{email:a,setEmail:s,loading:u,handleSubmit:d})]})},re=a(34),oe=a(75),ie=a.n(oe),le=a(76),ue=T()(N||(N=Object(G.a)(["\n  mutation userUpdate($input: UserUpdateInput!) {\n    userUpdate(input: $input) {\n      ...userInfo\n    }\n  }\n  ","\n"])),M),je=T()(y||(y=Object(G.a)(["\n  mutation userCreate {\n    userCreate {\n      username\n      email\n    }\n  }\n"]))),de=T()(w||(w=Object(G.a)(["\n  mutation postCreate($input: PostCreateInput!) {\n    postCreate(input: $input) {\n      ...postData\n    }\n  }\n  ","\n"])),Q),be=T()(S||(S=Object(G.a)(["\n  mutation postUpdate($id: ID!, $input: PostCreateInput!) {\n    postUpdate(id: $id, input: $input) {\n      ...postData\n    }\n  }\n  ","\n"])),Q),pe=T()(C||(C=Object(G.a)(["\n  mutation postDelete($id: ID!) {\n    postDelete(id: $id) {\n      ...postData\n    }\n  }\n  ","\n"])),Q),me=function(e){var t=e.handleSubmit,a=e.handleChange,n=e.username,s=e.name,c=e.email,r=e.about,o=e.loading;return Object(I.jsxs)("form",{onSubmit:t,children:[Object(I.jsxs)("div",{className:"form-group",children:[Object(I.jsx)("label",{children:"Username"}),Object(I.jsx)("input",{type:"text",name:"username",value:n,onChange:a,className:"form-control",placeholder:"Username",disabled:o})]}),Object(I.jsxs)("div",{className:"form-group",children:[Object(I.jsx)("label",{children:"Name"}),Object(I.jsx)("input",{type:"text",name:"name",value:s,onChange:a,className:"form-control",placeholder:"Name",disabled:o})]}),Object(I.jsxs)("div",{className:"form-group",children:[Object(I.jsx)("label",{children:"Email"}),Object(I.jsx)("input",{type:"email",name:"email",value:c,onChange:a,className:"form-control",placeholder:"Email",disabled:!0})]}),Object(I.jsxs)("div",{className:"form-group",children:[Object(I.jsx)("label",{children:"About"}),Object(I.jsx)("textarea",{name:"about",value:r,onChange:a,className:"form-control",placeholder:"About",disabled:o})]}),Object(I.jsx)("button",{className:"btn btn-primary",type:"submit",disabled:!c||o,children:"Submit"})]})},Oe=a(50),he=a(77),xe=a.n(he),ge=a(55),fe=a.n(ge),ve=function(e){var t=e.setValues,a=e.setLoading,s=e.values,c=e.singleUpload,r=void 0!==c&&c,o=Object(n.useContext)(D).state,i=function(e){a(!0),fe.a.post("".concat("https://graphql-server-node-edgard.herokuapp.com","/removeimage"),{public_id:e},{headers:{authtoken:o.user.token}}).then((function(n){if(a(!1),r){s.image;t(Object(u.a)(Object(u.a)({},s),{},{image:{url:"",public_id:""}}))}else{var c=s.images.filter((function(t){return t.public_id!==e}));t(Object(u.a)(Object(u.a)({},s),{},{images:c}))}})).catch((function(e){a(!1),console.log(e)}))};return Object(I.jsxs)("div",{className:"col-md-12 row",children:[Object(I.jsx)("div",{className:"col-md-3",children:Object(I.jsx)("div",{className:"form-group",children:Object(I.jsxs)("label",{className:"btn btn-primary left",children:["Upload Image",Object(I.jsx)("input",{hidden:!0,type:"file",accept:"image/*",onChange:function(e){a(!0);var n=!1;e.target.files[0]&&(n=!0),n&&xe.a.imageFileResizer(e.target.files[0],300,300,"JPEG",100,0,(function(e){fe.a.post("".concat("https://graphql-server-node-edgard.herokuapp.com","/uploadimages"),{image:e},{headers:{authtoken:o.user.token}}).then((function(e){if(a(!1),console.log("CLOUDINARY UPLOAD",e),r){s.image;t(Object(u.a)(Object(u.a)({},s),{},{image:e.data}))}else{var n=s.images;t(Object(u.a)(Object(u.a)({},s),{},{images:[].concat(Object(Oe.a)(n),[e.data])}))}})).catch((function(e){a(!1),console.log("CLOUDINARY UPLOAD FAILED",e)}))}),"base64")},className:"form-control",placeholder:"Image"})]})})}),Object(I.jsxs)("div",{className:"col-md-9",children:[s.image&&Object(I.jsx)(X,{image:s.image,handleImageRemove:i},s.image.public_id),s.images&&s.images.map((function(e){return Object(I.jsx)(X,{image:e,handleImageRemove:i},e.public_id)}))]})]})},Ne=function(){var e=Object(n.useState)(""),t=Object(l.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)(!1),r=Object(l.a)(c,2),j=(r[0],r[1]),d=function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(t);case 2:j(!0),$.b.success("token is copied!");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=Object(n.useContext)(D).state.user,p=Object(n.useState)({username:"",name:"",email:"",about:"",images:[]}),m=Object(l.a)(p,2),O=m[0],h=m[1],x=Object(n.useState)(!1),g=Object(l.a)(x,2),f=g[0],v=g[1],N=Object(B.c)(H).data;Object(n.useMemo)((function(){N&&(console.log(N.profile),h(Object(u.a)(Object(u.a)({},O),{},{username:N.profile.username,name:N.profile.name,email:N.profile.email,about:N.profile.about,images:ie()(N.profile.images,["__typename"])})))}),[N]);var y=Object(B.b)(ue,{update:function(e){e.data;$.b.success("Profile updated")}}),w=Object(l.a)(y,1)[0];return Object(I.jsxs)("div",{className:"container p-5",children:[Object(I.jsxs)("div",{className:"row",children:[Object(I.jsxs)("div",{className:"col-md-12 row mb-5 px-3",children:[Object(I.jsx)("div",{className:"col-md-8",children:Object(I.jsx)("input",{value:b.token,className:"form-control",disabled:!0})}),Object(I.jsx)("div",{className:"col-md-4",children:Object(I.jsx)(le.CopyToClipboard,{text:a,onCopy:function(){return d(b.token)},children:Object(I.jsx)("div",{className:"copy-area",children:Object(I.jsx)("button",{className:"btn btn-primary btn-outline-primary",children:"Copy Token to Clipboard"})})})})]}),Object(I.jsx)("div",{className:"col-md-12 mb-3",children:f?Object(I.jsx)("h4",{className:"text-danger",children:"Loading..."}):Object(I.jsx)("h4",{children:"Profile"})}),Object(I.jsx)(ve,{setValues:h,setLoading:v,values:O,loading:f})]}),Object(I.jsx)(me,Object(u.a)(Object(u.a)({},O),{},{handleChange:function(e){h(Object(u.a)(Object(u.a)({},O),{},Object(re.a)({},e.target.name,e.target.value)))},handleSubmit:function(e){e.preventDefault(),v(!0),w({variables:{input:O}}),v(!1)},loading:f}))]})},ye=function(){var e=Object(n.useContext)(D).dispatch,t=Object(n.useState)("demo@mail.cl"),a=Object(l.a)(t,2),s=a[0],c=a[1],r=Object(n.useState)("demo2021"),u=Object(l.a)(r,2),d=u[0],b=u[1],p=Object(n.useState)(!1),m=Object(l.a)(p,2),O=m[0],h=m[1],x=Object(j.f)(),g=function(){var t=Object(i.a)(o.a.mark((function t(a){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),h(!0),t.prev=2,t.next=5,P.signInWithEmailAndPassword(s,d).then(function(){var t=Object(i.a)(o.a.mark((function t(a){var n,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.user,t.next=3,n.getIdTokenResult();case 3:s=t.sent,e({type:"LOGGED_IN_USER",payload:{email:n.email,token:s.token}}),x.push("/");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 5:t.next=12;break;case 7:t.prev=7,t.t0=t.catch(2),console.log("login error",t.t0),$.b.error(t.t0.message),h(!1);case 12:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e){return t.apply(this,arguments)}}();return Object(I.jsxs)("div",{className:"container p-5",children:[O?Object(I.jsx)("h4",{className:"text-danger",children:"Loading..."}):Object(I.jsx)("h4",{children:"Login"}),Object(I.jsx)("button",{onClick:function(){P.signInWithPopup(k).then(function(){var t=Object(i.a)(o.a.mark((function t(a){var n,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.user,t.next=3,n.getIdTokenResult();case 3:s=t.sent,e({type:"LOGGED_iN_USER",payload:{email:n.email,token:s.token}}),x.push("/profile");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},className:"btn btn-raised btn-danger mt-5",children:"Login with Google"}),Object(I.jsx)(ae,{email:s,setEmail:c,password:d,setPassword:b,loading:O,handleSubmit:g,showPasswordInput:"true"}),Object(I.jsx)(L.b,{className:"text-danger float-right",to:"/password/forgot",children:"Forgot Password"})]})},we=function(){var e=Object(n.useContext)(D).dispatch,t=Object(n.useState)(""),a=Object(l.a)(t,2),s=a[0],c=a[1],r=Object(n.useState)(""),u=Object(l.a)(r,2),d=u[0],b=u[1],p=Object(n.useState)(!1),m=Object(l.a)(p,2),O=m[0],h=m[1],x=Object(j.f)();Object(n.useEffect)((function(){c(window.localStorage.getItem("emailForRegistration"))}),[x]);var g=Object(B.b)(je),f=Object(l.a)(g,1)[0],v=function(){var t=Object(i.a)(o.a.mark((function t(a){var n,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),h(!0),s&&d){t.next=5;break}return $.b.error("Email and password is required"),t.abrupt("return");case 5:return t.prev=5,t.next=8,P.signInWithEmailLink(s,window.location.href);case 8:if(!t.sent.user.emailVerified){t.next=20;break}return window.localStorage.removeItem("emailForRegistration"),n=P.currentUser,t.next=14,n.updatePassword(d);case 14:return t.next=16,n.getIdTokenResult();case 16:c=t.sent,e({type:"LOGGED_IN_USER",payload:{email:n.email,token:c.token}}),f(),x.push("/password/update");case 20:t.next=27;break;case 22:t.prev=22,t.t0=t.catch(5),console.log("register complete error",t.t0.message),h(!1),$.b.error(t.t0.message);case 27:case"end":return t.stop()}}),t,null,[[5,22]])})));return function(e){return t.apply(this,arguments)}}();return Object(I.jsxs)("div",{className:"container p-5",children:[O?Object(I.jsx)("h4",{className:"text-danger",children:"Loading..."}):Object(I.jsx)("h4",{children:"Complete Your Registration"}),Object(I.jsx)(ae,{email:s,setEmail:c,password:d,setPassword:b,loading:O,handleSubmit:v,showPasswordInput:"true"})]})},Se=function(e){var t=e.path,a=Object(n.useState)(5),s=Object(l.a)(a,2),c=s[0],r=s[1],o=Object(j.f)();return Object(n.useEffect)((function(){var e=setInterval((function(){r((function(e){return--e}))}),1e3);return 0===c&&o.push(t),function(){return clearInterval(e)}}),[c]),Object(I.jsx)("div",{className:"container p-5 text-center",children:Object(I.jsxs)("p",{children:["Redirecting you in ",c," seconds..."]})})},Ce=function(e){var t=Object.assign({},e),a=Object(n.useContext)(D).state,s=Object(n.useState)(!1),c=Object(l.a)(s,2),r=c[0],o=c[1];Object(n.useEffect)((function(){a.user&&o(!0)}),[a.user]);return r?Object(I.jsx)("div",{className:"container-fluid pt-5",children:Object(I.jsxs)("div",{className:"row",children:[Object(I.jsx)("div",{className:"col-md-4",children:Object(I.jsx)("nav",{children:Object(I.jsxs)("ul",{className:"nav flex-column",children:[Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)(L.b,{className:"nav-link",to:"/profile",children:"Profile"})}),Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)(L.b,{className:"nav-link",to:"/password/update",children:"Password"})}),Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)(L.b,{className:"nav-link",to:"/post/create",children:"Post"})})]})})}),Object(I.jsx)("div",{className:"col-md-8",children:Object(I.jsx)(j.a,Object(u.a)({},t))})]})}):Object(I.jsx)(Se,{path:"/login"})},Pe=function(e){var t=Object.assign({},e),a=Object(n.useContext)(D).state,s=Object(j.f)();return Object(n.useEffect)((function(){a.user&&s.push("profile")}),[s,a.user]),Object(I.jsx)("div",{className:"container-fluid p-5",children:Object(I.jsx)(j.a,Object(u.a)({},t))})},ke=a(134),Ie=a(135),Ee=function(e){var t=e.show,a=e.onClose,n=e.postModal,s=e.postDelete,c=e.setPostId,r=function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(t);case 2:s({variables:{id:t}}),a(),$.b.success("Post deleted");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(I.jsx)(I.Fragment,{children:Object(I.jsxs)(ke.a,{show:t,onHide:a,children:[Object(I.jsx)(ke.a.Header,{closeButton:!0,children:Object(I.jsx)(ke.a.Title,{children:"Delete Post"})}),Object(I.jsxs)(ke.a.Body,{children:[Object(I.jsx)("p",{children:"Are you sure to delete the post:"}),Object(I.jsxs)("p",{children:[Object(I.jsx)("b",{children:null===n||void 0===n?void 0:n.content}),"?"]})]}),Object(I.jsxs)(ke.a.Footer,{children:[Object(I.jsx)(Ie.a,{variant:"secondary",onClick:a,children:"Close"}),Object(I.jsx)(Ie.a,{variant:"primary",onClick:function(){return r(null===n||void 0===n?void 0:n._id)},children:"Confirm"})]})]})})},_e=function(e){var t=e.show,a=e.onClose,n=e.postModal;return Object(I.jsx)(I.Fragment,{children:Object(I.jsxs)(ke.a,{show:t,onHide:a,children:[Object(I.jsx)(ke.a.Header,{closeButton:!0,children:Object(I.jsx)(ke.a.Title,{children:"Show Post"})}),Object(I.jsxs)(ke.a.Body,{children:[Object(I.jsx)("img",{src:n.image.url,alt:n.image.public_id,style:{height:"100px"},className:"img-thumbnail mb-4"},n.image.public_id),Object(I.jsx)("p",{children:"Content"}),Object(I.jsx)("p",{children:Object(I.jsx)("small",{children:n.content})}),Object(I.jsx)("br",{}),Object(I.jsx)("p",{children:"Posted By"}),Object(I.jsx)("p",{children:Object(I.jsxs)("small",{children:["@",n.postedBy.username," - (",n.postedBy.email,")"]})})]}),Object(I.jsx)(ke.a.Footer,{children:Object(I.jsx)(Ie.a,{variant:"secondary",onClick:a,children:"Close"})})]})})},De={content:"",image:{url:"https://via.placeholder.com/200x200.png?text=Post",public_id:"123"}},Ue=function(){Object(n.useContext)(D);var e=Object(n.useState)(!1),t=Object(l.a)(e,2),a=t[0],s=t[1],c=Object(n.useState)(!1),r=Object(l.a)(c,2),j=r[0],d=r[1],b=Object(n.useState)(!1),p=Object(l.a)(b,2),m=p[0],O=p[1],h=Object(n.useState)(""),x=Object(l.a)(h,2),g=x[0],f=x[1],v=function(){return s(!0)},N=Object(n.useState)(De),y=Object(l.a)(N,2),w=y[0],S=y[1],C=Object(n.useState)(!1),P=Object(l.a)(C,2),k=P[0],E=P[1],_=Object(n.useState)(20),U=Object(l.a)(_,2),L=U[0],q=(U[1],Object(n.useState)(1)),R=Object(l.a)(q,2),A=R[0],G=(R[1],Object(n.useState)("")),F=Object(l.a)(G,2),T=F[0],M=(F[1],Object(n.useState)("")),Q=Object(l.a)(M,2),H=Q[0],V=Q[1],z=Object(B.c)(Y,{variables:{limit:L,page:A}}).data,J=w.content,W=Object(B.b)(de,{update:function(e,t){var a=t.data.postCreate,n=e.readQuery({query:Y,variables:{limit:L,page:A}}).postsByUser;e.writeQuery({query:Y,variables:{limit:L,page:A},data:{postsByUser:{__typename:"PostInfo",posts:[a].concat(Object(Oe.a)(n.posts))}}})},onError:function(e){return console.log(e.graphqlQLError[0].message)}}),K=Object(l.a)(W,1)[0],X=Object(B.b)(be,{update:function(e,t){t.data.postUpdate;var a=e.readQuery({query:Y,variables:{limit:L,page:A,search:T}}).allPosts;console.log("allPosts",a),e.writeQuery({query:Y,variables:{limit:L,page:A,search:T},data:{allPosts:{__typename:"PostInfo",posts:a.posts}}})},onError:function(e){return console.log(e.graphqlQLError[0].message)}}),ee=Object(l.a)(X,1)[0],te=Object(B.b)(pe,{update:function(e,t){t.data.postDeleted;var a=e.readQuery({query:Y,variables:{limit:L,page:A,search:T}}).allPosts;e.writeQuery({query:Y,variables:{limit:L,page:A,search:T},data:{allPosts:{__typename:"PostInfo",posts:a.posts.filter((function(e){return e._id!==H}))}}})},onError:function(e){return console.log(e.graphqlQLError[0].message)}}),ae=Object(l.a)(te,1)[0],ne=function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),E(!0),K({variables:{input:w}}),S(De),E(!1),$.b.success("Post created");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=function(e){e.preventDefault(),S(Object(u.a)(Object(u.a)({},w),{},Object(re.a)({},e.target.name,e.target.value)))};return Object(I.jsxs)("div",{className:"container p-5",children:[k?Object(I.jsx)("h4",{className:"text-danger",children:"Loading"}):Object(I.jsx)("h4",{children:"Create"}),Object(I.jsx)(ve,{values:w,loading:k,setValues:S,setLoading:E,singleUpload:!0}),Object(I.jsx)("div",{className:"row",children:Object(I.jsx)("div",{className:"col",children:Object(I.jsxs)("form",{onSubmit:ne,children:[Object(I.jsx)("div",{className:"form-group",children:Object(I.jsx)("textarea",{value:J,onChange:se,name:"content",rows:"5",className:"md-textarea form-control",placeholder:"Write something cool",maxLength:"150",disabled:k})}),Object(I.jsx)("button",{className:"btn btn-primary",type:"submit",disabled:k||!J,children:"Post"})]})})}),Object(I.jsx)("hr",{}),Object(I.jsx)("div",{className:"row p-5",children:z&&z.postsByUser.posts.map((function(e){return Object(I.jsx)("div",{className:"col-md-6 pt-5",children:Object(I.jsx)(Z,{post:e,onShow:v,postModal:f})},e._id)}))}),a&&Object(I.jsx)(_e,{show:a,onClose:function(){return s(!1)},postModal:g}),j&&Object(I.jsx)(Ee,{show:j,onClose:function(){return d(!1)},postModal:g,postDelete:ae,setPostId:V}),m&&Object(I.jsx)(Ee,{show:m,onClose:function(){return O(!1)},postModal:g,postUpdate:ee})]})},Le=function(){var e=Object(j.h)(),t=Object(B.c)(V,{variables:{username:e.username}}),a=t.loading,n=t.data;return a?Object(I.jsx)("p",{className:"p-5",children:"Loading..."}):Object(I.jsxs)("div",{className:"container",children:[Object(I.jsx)("br",{}),Object(I.jsx)("br",{}),Object(I.jsx)(ee,{user:n.publicProfile})]})},qe={id:"",content:"",image:{url:"https://via.placeholder.com/200x200.png?text=Post",public_id:"123"}},Re=function(e){var t=e.show,a=e.onClose,s=e.postModal,c=e.postUpdate,r=Object(n.useState)(!1),o=Object(l.a)(r,2),i=o[0],j=o[1],d=Object(n.useState)(qe),b=Object(l.a)(d,2),p=b[0],m=b[1],O=function(e){e.preventDefault(),m(Object(u.a)(Object(u.a)({},p),{},Object(re.a)({},e.target.name,e.target.value)))},h=p.content;Object(n.useEffect)((function(){if(s){var e,t,a={id:null===s||void 0===s?void 0:s._id,content:null===s||void 0===s?void 0:s.content,image:{url:null===s||void 0===s||null===(e=s.image)||void 0===e?void 0:e.url,public_id:null===s||void 0===s||null===(t=s.image)||void 0===t?void 0:t.public_id}};m(a)}}),[s]);return Object(I.jsx)(I.Fragment,{children:Object(I.jsxs)(ke.a,{show:t,onHide:a,children:[Object(I.jsx)(ke.a.Header,{closeButton:!0,children:Object(I.jsx)(ke.a.Title,{children:i?Object(I.jsx)("h4",{className:"text-danger",children:"Loading"}):Object(I.jsx)("h4",{children:"Post Update"})})}),Object(I.jsxs)(ke.a.Body,{children:[Object(I.jsx)(ve,{values:p,loading:i,setValues:m,setLoading:j,singleUpload:!0}),Object(I.jsx)(I.Fragment,{children:Object(I.jsx)("div",{className:"form-group",children:Object(I.jsx)("textarea",{value:h,onChange:O,name:"content",rows:"5",className:"md-textarea form-control",placeholder:"Write something cool",maxLength:"150",disabled:i})})})]}),Object(I.jsxs)(ke.a.Footer,{children:[Object(I.jsx)(Ie.a,{variant:"secondary",onClick:a,children:"Close"}),Object(I.jsx)(Ie.a,{variant:"primary",onClick:function(){j(!0);var e=p.id;delete p.id,c({variables:{id:e,input:p}}),j(!1),a(),$.b.success("Post updated")},disabled:i||!h,children:"Confirm"})]})]})})},$e=function(){var e=null,t=Object(n.useContext)(D);if(t&&t.state.user){var a=t.state.user.email;e=a}var s=Object(n.useState)(!1),c=Object(l.a)(s,2),r=c[0],o=c[1],i=Object(n.useState)(!1),u=Object(l.a)(i,2),d=u[0],b=u[1],p=Object(n.useState)(!1),m=Object(l.a)(p,2),O=m[0],h=m[1],x=Object(n.useState)(""),g=Object(l.a)(x,2),f=g[0],v=g[1],N=function(){return o(!0)},y=function(){return b(!0)},w=function(){return h(!0)},S=Object(n.useState)(!1),C=Object(l.a)(S,2),P=C[0],k=C[1],E=Object(n.useState)(1),_=Object(l.a)(E,2),U=_[0],L=_[1],q=Object(n.useState)(6),R=Object(l.a)(q,2),$=R[0],A=R[1],G=Object(n.useState)(""),F=Object(l.a)(G,2),T=F[0],M=F[1],Q=Object(n.useState)(""),H=Object(l.a)(Q,2),V=H[0],z=H[1],Y=Object(n.useState)(""),K=Object(l.a)(Y,2),X=K[0],ee=K[1],te=Object(B.c)(W,{variables:{limit:$,page:U,search:V}}).data,ae=Object(B.c)(J).data,ne=Object(B.b)(be,{update:function(e,t){t.data.postUpdate;var a=e.readQuery({query:W,variables:{limit:$,page:U,search:V}}).allPosts;console.log("allPosts",a),e.writeQuery({query:W,variables:{limit:$,page:U,search:V},data:{allPosts:{__typename:"PostInfo",posts:a.posts}}})},onError:function(e){return console.log(e.graphqlQLError[0].message)}}),se=Object(l.a)(ne,1)[0],ce=Object(B.b)(pe,{update:function(e,t){t.data.postDeleted;var a=e.readQuery({query:W,variables:{limit:$,page:U,search:V}}).allPosts;e.writeQuery({query:W,variables:{limit:$,page:U,search:V},data:{allPosts:{__typename:"PostInfo",posts:a.posts.filter((function(e){return e._id!==X}))}}})},onError:function(e){return console.log(e.graphqlQLError[0].message)}}),re=Object(l.a)(ce,1)[0],oe=Object(j.g)();Object(n.useEffect)((function(){oe.pathname&&oe.state&&(k(!0),M(oe.state.search),z(oe.state.search),k(!1))}),[oe]);return Object(I.jsxs)("div",{className:"container p-5",children:[P&&!ae?Object(I.jsx)("h4",{children:"Loading...."}):Object(I.jsx)(I.Fragment,{children:Object(I.jsxs)("h1",{className:"text-center",children:["All Posts ",Object(I.jsxs)("h6",{children:["(Total en la base de datos: ",JSON.stringify(null===ae||void 0===ae?void 0:ae.totalPosts),")"]})]})}),Object(I.jsx)("div",{className:"row",children:Object(I.jsx)("div",{className:"col-12",children:Object(I.jsxs)("form",{className:"form-inline mt-5 float-right",onSubmit:function(e){e.preventDefault(),console.log("entro al handleSubmit"),z(T)},children:[Object(I.jsxs)("div",{className:"form-group my-2 my-lg-0 mr-3",children:[Object(I.jsx)("input",{className:"form-control mr-sm-2",type:"search",name:"search",onChange:function(e){L(1),M(e.target.value)},value:T,placeholder:"","aria-label":"Search"}),Object(I.jsx)("button",{className:"btn btn-outline-success my-2 my-sm-0",type:"submit",children:Object(I.jsx)("span",{children:"Search"})})]}),Object(I.jsx)("div",{className:"form-group",children:Object(I.jsxs)("select",{className:"custom-select",onChange:function(e){e.preventDefault(),console.log(e.target.value),L(1),A(parseInt(e.target.value))},children:[Object(I.jsx)("option",{value:"",children:"N\xb0 por p\xe1gina"}),Object(I.jsx)("option",{value:"3",children:"3"}),Object(I.jsx)("option",{value:"6",children:"6"}),Object(I.jsx)("option",{value:"9",children:"9"}),Object(I.jsx)("option",{value:"12",children:"12"})]})})]})})}),Object(I.jsx)("div",{className:"row",children:te&&te.allPosts.posts.map((function(t){return Object(I.jsx)("div",{className:"col-md-4 pt-5",children:Object(I.jsx)(Z,{post:t,onShow:N,onShowDelete:y,onShowUpdate:w,postModal:v,email:e})},t._id)}))}),Object(I.jsx)("div",{className:"row",children:Object(I.jsxs)("div",{className:"col-12 text-center pt-5",children:[te&&U<=te.allPosts.pages&&U>1&&Object(I.jsx)("button",{onClick:function(){return L((function(e){return e-1}))},className:"btn btn-primary float-left",type:"button",children:"Prev Page"}),te&&U!=te.allPosts.pages&&Object(I.jsx)("button",{onClick:function(){return L((function(e){return e+1}))},className:"btn btn-primary float-right",type:"button",children:"Next Page"})]})}),r&&Object(I.jsx)(_e,{show:r,onClose:function(){return o(!1)},postModal:f}),d&&Object(I.jsx)(Ee,{show:d,onClose:function(){return b(!1)},postModal:f,postDelete:re,setPostId:ee}),O&&Object(I.jsx)(Re,{show:O,onClose:function(){return h(!1)},postModal:f,postUpdate:se})]})},Ae={id:"",content:"",image_url:""},Be=function(){var e=Object(j.h)().idPost,t=Object(B.c)(K,{variables:{id:e}}),a=t.loading,s=t.data,c=Object(n.useState)(Ae),r=Object(l.a)(c,2),o=r[0],i=r[1],d=Object(n.useState)(!1),b=Object(l.a)(d,2),p=(b[0],b[1]),m=o.id,O=o.content;Object(n.useMemo)((function(){s&&(console.log(s.postShow),i(Object(u.a)(Object(u.a)({},o),{},{id:s.postShow._id,content:s.postShow.content,image_url:s.postShow.image.url})))}),[s]);var h=Object(B.b)(be,{update:function(e){var t=e.data;console.log("POST UPDATE MUTATION",t),$.b.success("Post updated")}}),x=Object(l.a)(h,1)[0];return console.log(e),Object(I.jsx)("div",{className:"container p-5",children:a?Object(I.jsx)("h3",{children:"Loading..."}):Object(I.jsxs)("div",{className:"row",children:[Object(I.jsx)("div",{className:"col-12",children:Object(I.jsx)("h3",{children:"Actualizar Post"})}),Object(I.jsx)("div",{className:"col-12",children:Object(I.jsxs)("form",{onSubmit:function(e){e.preventDefault(),p(!0),x({variables:{id:o.id,input:{content:o.content}}}),p(!1)},children:[Object(I.jsx)("div",{className:"form-group",children:Object(I.jsx)("input",{type:"hidden",name:"id",value:m})}),Object(I.jsxs)("div",{className:"form-group",children:[Object(I.jsx)("label",{htmlFor:"content",children:"Description"}),Object(I.jsx)("textarea",{onChange:function(e){i(Object(u.a)(Object(u.a)({},o),{},Object(re.a)({},e.target.name,e.target.value)))},className:"form-control",id:"content",name:"content",rows:"5",value:O})]}),Object(I.jsx)("div",{className:"form-group",children:Object(I.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Guardar Cambios"})})]})})]})})},Ge=function(){var e=Object(n.useContext)(D).state.user,t=new q.a({uri:"https://graphql-server-node-edgard.herokuapp.com/graphql",request:function(t){t.setContext({headers:{authtoken:e?e.token:""}})}});return Object(I.jsxs)(R.a,{client:t,children:[Object(I.jsx)(A,{}),Object(I.jsx)($.a,{}),Object(I.jsxs)(j.c,{children:[Object(I.jsx)(j.a,{exact:!0,path:"/",component:$e}),Object(I.jsx)(j.a,{exact:!0,path:"/users",component:te}),Object(I.jsx)(j.a,{exact:!0,path:"/posts",component:$e}),Object(I.jsx)(Pe,{exact:!0,path:"/register",component:ne}),Object(I.jsx)(Pe,{exact:!0,path:"/login",component:ye}),Object(I.jsx)(j.a,{exact:!0,path:"/complete-registration",component:we}),Object(I.jsx)(j.a,{exact:!0,path:"/password/forgot",component:ce}),Object(I.jsx)(Ce,{exact:!0,path:"/password/update",component:se}),Object(I.jsx)(Ce,{exact:!0,path:"/profile",component:Ne}),Object(I.jsx)(Ce,{exact:!0,path:"/post/create",component:Ue}),Object(I.jsx)(Ce,{exact:!0,path:"/post/:idPost",component:Be}),Object(I.jsx)(j.a,{exact:!0,path:"/user/:username",component:Le})]})]})};c.a.render(Object(I.jsx)(L.a,{children:Object(I.jsx)(U,{children:Object(I.jsx)(Ge,{})})}),document.getElementById("root"))}},[[129,1,2]]]);
//# sourceMappingURL=main.39d35257.chunk.js.map